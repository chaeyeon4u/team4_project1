<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.mycompany.webapp.dao.join.OrderCancellationDao">


	<resultMap type="orders" id="ordersMap">
		<id property="id" column="ordersid"/>
		<result property="zipcode" column="ordersZipcode"/>
		<result property="address" column="address"/>
		<result property="receiver" column="receiver"/>
		<result property="phone" column="ordersPhone"/>
		<result property="tel" column="ordersTel"/>
		<result property="memo" column="memo"/>
		<result property="email" column="ordersEmail"/>
		<result property="usedMileage" column="used_mileage"/>
		<result property="beforeDcPrice" column="before_dc_price"/>
		<result property="afterDcPrice" column="after_dc_price"/>
		<result property="paymentInfo" column="payment_info"/>
		<result property="status" column="status"/>
		<result property="deliveryStatus" column="delivery_status"/>
		<result property="memberId" column="member_id"/>
		<result property="paymentMethodCode" column="payment_method_code"/>
	</resultMap>
	
	<resultMap type="orderItem" id="orderItemMap">
		<id property="productStockId" column="orderstockid"/>
		<result property="ordersId" column="orders_id"/>
		<result property="count" column="count"/>
		<result property="totalPrice" column="total_price"/>
		<result property="orderByTime" column="order_by_time"/>
	</resultMap>
	
	<resultMap type="productCommon" id="productCommonMap">
		<id property="id" column="pcommonId"/>
		<result property="name" column="productName"/>
		<result property="note" column="note"/>
		<result property="brandNo" column="brand_no"/>
	</resultMap>
	
	<resultMap type="productColor" id="productColorMap">
		<id property="id" column="pcolorId"/>
		<result property="img1" column="img1"/>
		<result property="img2" column="img2"/>
		<result property="img3" column="img3"/>
		<result property="colorImg" column="color_img"/>
		<result property="productCommonId" column="product_common_id"/>
		<result property="colorCode" column="color_code"/>
		<result property="price" column="price"/>
	</resultMap>
	
	<resultMap type="productStock" id="productStockMap">
		<id property="id" column="id"/>
		<result property="productColorId" column="product_color_id"/>
		<result property="sizeCode" column="size_code"/>
		<result property="stock" column="stock"/>
	</resultMap>
	
	<resultMap type="brand" id="brandMap">
		<id property="no" column="no"/>
		<result property="name" column="brandName"/>
	</resultMap>
	
	<resultMap type="mileage" id="mileageMap">
		<id property="memberId" column="member_id"/>
		<result property="issueDate" column="issue_date"/>
		<result property="amount" column="amount"/>
		<result property="name" column="name"/>
		<result property="content" column="content"/>
		<result property="category" column="category"/>
		<result property="expireDate" column="expire_date"/>
		<result property="status" column="mileageStatus"/>
	</resultMap>
	
	<resultMap type="com.mycompany.webapp.dto.OrderCancellation" id="orderCancellationMap">
		<collection property="orders" resultMap="ordersMap"/>
		<collection property="orderItem" resultMap="orderItemMap"/>
		<collection property="productCommon" resultMap="productCommonMap"/>
		<collection property="productColor" resultMap="productColorMap"/>
		<collection property="productStock" resultMap="productStockMap"/>
		<collection property="brand" resultMap="brandMap"/>
		<collection property="mileage" resultMap="mileageMap"/>
	</resultMap>
	
	<select id="slelectProducts" parameterType="map" resultMap="orderCancellationMap">
	 	select order_item.product_stock_id as orderstockid,orders_id as ordersid, order_item.count,orders.status,orders.delivery_status,mileage.amount,
            brand.name as brandName,product_common.name as productName,product_stock.size_code,order_by_time,
            product_color.color_code,total_price,after_dc_price,img1,orders.before_dc_price
			from order_item,orders,brand,product_common,product_color,product_stock,mileage
			where orders.member_id = #{mid, jdbcType=VARCHAR}
			and orders.id = #{ordersId, jdbcType=VARCHAR}
			and orders.id = order_item.orders_id
			and order_item.product_stock_id = product_stock.id
			and product_stock.product_color_id = product_color.id
			and product_color.id = product_stock.product_color_id
			and product_common.id = product_color.product_common_id
			and product_common.brand_no = brand.no
	</select>
</mapper>